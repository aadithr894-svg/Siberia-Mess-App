{% extends 'base.html' %}
{% block content %}
<div class="container mt-4">

  <h2 class="mb-4 text-center">ğŸ“Š Daily Meal Attendance</h2>

  <!-- Today's Counts Cards -->
  <div class="row mb-4">
    <div class="col-md-4 mb-2">
      <div class="card text-white bg-success text-center p-3">
        <h4>ğŸ³ Breakfast</h4>
        <p class="display-4" id="breakfastCount">{{ counts_by_date[today]['breakfast'] if today in counts_by_date else 0 }}</p>
      </div>
    </div>
    <div class="col-md-4 mb-2">
      <div class="card text-white bg-primary text-center p-3">
        <h4>ğŸ² Lunch</h4>
        <p class="display-4" id="lunchCount">{{ counts_by_date[today]['lunch'] if today in counts_by_date else 0 }}</p>
      </div>
    </div>
    <div class="col-md-4 mb-2">
      <div class="card text-white bg-warning text-center p-3">
        <h4>ğŸ½ Dinner</h4>
        <p class="display-4" id="dinnerCount">{{ counts_by_date[today]['dinner'] if today in counts_by_date else 0 }}</p>
      </div>
    </div>
  </div>

  <!-- Historical Counts Table -->
  <div class="table-responsive">
    <table class="table table-bordered table-striped">
      <thead class="table-dark">
        <tr>
          <th>Date</th>
          <th>Breakfast</th>
          <th>Lunch</th>
          <th>Dinner</th>
        </tr>
      </thead>
      <tbody>
        {% for date_key, meals in counts_by_date.items()|sort %}
        <tr>
          <td>{{ date_key }}</td>
          <td>{{ meals.get('breakfast', 0) }}</td>
          <td>{{ meals.get('lunch', 0) }}</td>
          <td>{{ meals.get('dinner', 0) }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

</div>

<!-- Auto refresh today counts every 2 minutes -->
<script>
  setInterval(() => {
    fetch("/admin/qr_scan_counts_json")  // create a separate route returning JSON of today's counts
      .then(res => res.json())
      .then(data => {
        document.getElementById('breakfastCount').innerText = data.breakfast || 0;
        document.getElementById('lunchCount').innerText = data.lunch || 0;
        document.getElementById('dinnerCount').innerText = data.dinner || 0;
      });
  }, 120000); // 120000 ms = 2 minutes
</script>
{% endblock %}
